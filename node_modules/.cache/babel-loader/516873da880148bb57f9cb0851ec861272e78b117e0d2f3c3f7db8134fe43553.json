{"ast":null,"code":"import _slicedToArray from \"C:/Users/zhouy/WebstormProjects/lingo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _toConsumableArray from \"C:/Users/zhouy/WebstormProjects/lingo/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport { useStyleInject } from '../StyleContext';\nimport useHMR from './useHMR';\nimport { onBeforeUnmount, watch, watchEffect, shallowRef } from 'vue';\nexport default function useClientCache(prefix, keyPath, cacheFn, onCacheRemove) {\n  var styleContext = useStyleInject();\n  var fullPathStr = shallowRef('');\n  var res = shallowRef();\n  watchEffect(function () {\n    fullPathStr.value = [prefix].concat(_toConsumableArray(keyPath.value)).join('%');\n  });\n  var HMRUpdate = useHMR();\n  var clearCache = function clearCache(pathStr) {\n    styleContext.value.cache.update(pathStr, function (prevCache) {\n      var _ref = prevCache || [],\n        _ref2 = _slicedToArray(_ref, 2),\n        _ref2$ = _ref2[0],\n        times = _ref2$ === void 0 ? 0 : _ref2$,\n        cache = _ref2[1];\n      var nextCount = times - 1;\n      if (nextCount === 0) {\n        onCacheRemove === null || onCacheRemove === void 0 ? void 0 : onCacheRemove(cache, false);\n        return null;\n      }\n      return [times - 1, cache];\n    });\n  };\n  watch(fullPathStr, function (newStr, oldStr) {\n    if (oldStr) clearCache(oldStr);\n    // Create cache\n    styleContext.value.cache.update(newStr, function (prevCache) {\n      var _ref3 = prevCache || [],\n        _ref4 = _slicedToArray(_ref3, 2),\n        _ref4$ = _ref4[0],\n        times = _ref4$ === void 0 ? 0 : _ref4$,\n        cache = _ref4[1];\n      // HMR should always ignore cache since developer may change it\n      var tmpCache = cache;\n      if (process.env.NODE_ENV !== 'production' && cache && HMRUpdate) {\n        onCacheRemove === null || onCacheRemove === void 0 ? void 0 : onCacheRemove(tmpCache, HMRUpdate);\n        tmpCache = null;\n      }\n      var mergedCache = tmpCache || cacheFn();\n      return [times + 1, mergedCache];\n    });\n    res.value = styleContext.value.cache.get(fullPathStr.value)[1];\n  }, {\n    immediate: true\n  });\n  onBeforeUnmount(function () {\n    clearCache(fullPathStr.value);\n  });\n  return res;\n}","map":{"version":3,"names":["useStyleInject","useHMR","onBeforeUnmount","watch","watchEffect","shallowRef","useClientCache","prefix","keyPath","cacheFn","onCacheRemove","styleContext","fullPathStr","res","value","concat","_toConsumableArray","join","HMRUpdate","clearCache","pathStr","cache","update","prevCache","_ref","_ref2","_slicedToArray","_ref2$","times","nextCount","newStr","oldStr","_ref3","_ref4","_ref4$","tmpCache","process","env","NODE_ENV","mergedCache","get","immediate"],"sources":["C:/Users/zhouy/WebstormProjects/lingo/node_modules/ant-design-vue/es/_util/cssinjs/hooks/useGlobalCache.js"],"sourcesContent":["import { useStyleInject } from '../StyleContext';\nimport useHMR from './useHMR';\nimport { onBeforeUnmount, watch, watchEffect, shallowRef } from 'vue';\nexport default function useClientCache(prefix, keyPath, cacheFn, onCacheRemove) {\n  const styleContext = useStyleInject();\n  const fullPathStr = shallowRef('');\n  const res = shallowRef();\n  watchEffect(() => {\n    fullPathStr.value = [prefix, ...keyPath.value].join('%');\n  });\n  const HMRUpdate = useHMR();\n  const clearCache = pathStr => {\n    styleContext.value.cache.update(pathStr, prevCache => {\n      const [times = 0, cache] = prevCache || [];\n      const nextCount = times - 1;\n      if (nextCount === 0) {\n        onCacheRemove === null || onCacheRemove === void 0 ? void 0 : onCacheRemove(cache, false);\n        return null;\n      }\n      return [times - 1, cache];\n    });\n  };\n  watch(fullPathStr, (newStr, oldStr) => {\n    if (oldStr) clearCache(oldStr);\n    // Create cache\n    styleContext.value.cache.update(newStr, prevCache => {\n      const [times = 0, cache] = prevCache || [];\n      // HMR should always ignore cache since developer may change it\n      let tmpCache = cache;\n      if (process.env.NODE_ENV !== 'production' && cache && HMRUpdate) {\n        onCacheRemove === null || onCacheRemove === void 0 ? void 0 : onCacheRemove(tmpCache, HMRUpdate);\n        tmpCache = null;\n      }\n      const mergedCache = tmpCache || cacheFn();\n      return [times + 1, mergedCache];\n    });\n    res.value = styleContext.value.cache.get(fullPathStr.value)[1];\n  }, {\n    immediate: true\n  });\n  onBeforeUnmount(() => {\n    clearCache(fullPathStr.value);\n  });\n  return res;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}