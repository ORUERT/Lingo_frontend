{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport { MessageOutlined } from '@ant-design/icons-vue';\n// import request from \"@/utils/request\";\n// let socket;\nexport default {\n  components: {\n    MessageOutlined: MessageOutlined\n  },\n  name: \"Im\",\n  data: function data() {\n    return {\n      circleUrl: 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png',\n      user: {},\n      isCollapse: false,\n      users: [],\n      chatUser: '',\n      text: \"\",\n      messages: [],\n      content: ''\n    };\n  },\n  created: function created() {\n    this.init();\n  },\n  methods: {\n    onck: function onck() {\n      console.log('onck');\n    },\n    send: function send() {\n      if (!this.chatUser) {\n        this.$message({\n          type: 'warning',\n          message: \"请选择聊天对象\"\n        });\n        return;\n      }\n      if (!this.text) {\n        this.$message({\n          type: 'warning',\n          message: \"请输入内容\"\n        });\n      } else {\n        if (typeof WebSocket == \"undefined\") {\n          console.log(\"您的浏览器不支持WebSocket\");\n        } else {\n          console.log(\"您的浏览器支持WebSocket\");\n          // 组装待发送的消息 json\n          // {\"from\": \"zhang\", \"to\": \"admin\", \"text\": \"聊天文本\"}\n          var message = {\n            from: this.user.username,\n            to: this.chatUser,\n            text: this.text\n          };\n          // socket.send(JSON.stringify(message));  // 将组装好的json发送给服务端，由服务端进行转发\n          this.messages.push({\n            user: this.user.username,\n            text: this.text\n          });\n          // 构建消息内容，本人消息\n          this.createContent(null, this.user.username, this.text);\n          this.text = '';\n        }\n      }\n    },\n    createContent: function createContent(remoteUser, nowUser, text) {\n      // 这个方法是用来将 json的聊天消息数据转换成 html的。\n      var html;\n      // 当前用户消息\n      if (nowUser) {\n        // nowUser 表示是否显示当前用户发送的聊天消息，绿色气泡\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" + \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: right; padding-right: 10px\\\">\\n\" + \"    <div class=\\\"tip left\\\">\" + text + \"</div>\\n\" + \"  </div>\\n\" + \"  <div class=\\\"el-col el-col-2\\\">\\n\" + \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" + \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" + \"  </span>\\n\" + \"  </div>\\n\" + \"</div>\";\n      } else if (remoteUser) {\n        // remoteUser表示远程用户聊天消息，蓝色的气泡\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" + \"  <div class=\\\"el-col el-col-2\\\" style=\\\"text-align: right\\\">\\n\" + \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" + \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" + \"  </span>\\n\" + \"  </div>\\n\" + \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: left; padding-left: 10px\\\">\\n\" + \"    <div class=\\\"tip right\\\">\" + text + \"</div>\\n\" + \"  </div>\\n\" + \"</div>\";\n      }\n      console.log(html);\n      this.content += html;\n    },\n    init: function init() {\n      this.user = localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {};\n      var username = this.user.username;\n      var _this = this;\n      if (typeof WebSocket == \"undefined\") {\n        console.log(\"您的浏览器不支持WebSocket\");\n      } else {\n        console.log(\"您的浏览器支持WebSocket\");\n        var socketUrl = \"ws://localhost:9090/imserver/\" + username;\n        // if (socket != null) {\n        //   socket.close();\n        //   socket = null;\n        // }\n        // 开启一个websocket服务\n        // socket = new WebSocket(socketUrl);\n        //打开事件\n        // socket.onopen = function () {\n        //   console.log(\"websocket已打开\");\n        // };\n        //  浏览器端收消息，获得从服务端发送过来的文本消息\n        // socket.onmessage = function (msg) {\n        //   console.log(\"收到数据====\" + msg.data)\n        //   let data = JSON.parse(msg.data)  // 对收到的json数据进行解析， 类似这样的： {\"users\": [{\"username\": \"zhang\"},{ \"username\": \"admin\"}]}\n        //   if (data.users) {  // 获取在线人员信息\n        //     _this.users = data.users.filter(user => user.username !== username)  // 获取当前连接的所有用户信息，并且排除自身，自己不会出现在自己的聊天列表里\n        //   } else {\n        //     // 如果服务器端发送过来的json数据 不包含 users 这个key，那么发送过来的就是聊天文本json数据\n        //     //  // {\"from\": \"zhang\", \"text\": \"hello\"}\n        //     if (data.from === _this.chatUser) {\n        //       _this.messages.push(data)\n        //       // 构建消息内容\n        //       _this.createContent(data.from, null, data.text)\n        //     }\n        //   }\n        // };\n        //关闭事件\n        // socket.onclose = function () {\n        //   console.log(\"websocket已关闭\");\n        // };\n        // //发生了错误事件\n        // socket.onerror = function () {\n        //   console.log(\"websocket发生了错误\");\n        // }\n      }\n    }\n  }\n};","map":{"version":3,"names":["MessageOutlined","components","name","data","circleUrl","user","isCollapse","users","chatUser","text","messages","content","created","init","methods","onck","console","log","send","$message","type","message","WebSocket","from","username","to","push","createContent","remoteUser","nowUser","html","localStorage","getItem","JSON","parse","_this","socketUrl"],"sources":["C:\\Users\\zhouy\\WebstormProjects\\lingo\\src\\view\\chat.vue"],"sourcesContent":["<template>\r\n  <div  style=\"padding: 10px; margin-bottom: 50px\">\r\n    <a-row >\r\n      <a-col class=\"chat-col\" :span=\"16\">\r\n        <div style=\"width: 800px; margin: 0 auto; background-color: white;\r\n                    border-radius: 5px; box-shadow: 0 0 10px #ccc\">\r\n          <div style=\"text-align: center; line-height: 50px;\">\r\n            Web聊天室（{{ chatUser }}）\r\n          </div>\r\n          <div style=\"height: 350px; overflow:auto; border-top: 1px solid #ccc\" v-html=\"content\"></div>\r\n          <a-input-group compact>\r\n            <a-input size=\"small\" style=\"border-radius:30px;width: 80%\" >\r\n              <template #suffix>\r\n                <message-outlined :style=\"{fontSize: '20px', color: '#08c'}\" @click=\"onck\" />\r\n              </template>\r\n            </a-input>\r\n\r\n          </a-input-group>\r\n        </div>\r\n      </a-col>\r\n    </a-row>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { MessageOutlined  } from '@ant-design/icons-vue';\r\n// import request from \"@/utils/request\";\r\n// let socket;\r\nexport default {\r\n  components: {\r\n    MessageOutlined\r\n  },\r\n  name: \"Im\",\r\n\r\n  data() {\r\n    return {\r\n      circleUrl: 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png',\r\n      user: {},\r\n      isCollapse: false,\r\n      users: [],\r\n      chatUser: '',\r\n      text: \"\",\r\n      messages: [],\r\n      content: ''\r\n    }\r\n  },\r\n  created() {\r\n    this.init()\r\n  },\r\n  methods: {\r\n    onck() {\r\n      console.log('onck')\r\n    },\r\n    send() {\r\n      if (!this.chatUser) {\r\n        this.$message({type: 'warning', message: \"请选择聊天对象\"})\r\n        return;\r\n      }\r\n      if (!this.text) {\r\n        this.$message({type: 'warning', message: \"请输入内容\"})\r\n      } else {\r\n        if (typeof (WebSocket) == \"undefined\") {\r\n          console.log(\"您的浏览器不支持WebSocket\");\r\n        } else {\r\n          console.log(\"您的浏览器支持WebSocket\");\r\n          // 组装待发送的消息 json\r\n          // {\"from\": \"zhang\", \"to\": \"admin\", \"text\": \"聊天文本\"}\r\n          let message = {from: this.user.username, to: this.chatUser, text: this.text}\r\n          // socket.send(JSON.stringify(message));  // 将组装好的json发送给服务端，由服务端进行转发\r\n          this.messages.push({user: this.user.username, text: this.text})\r\n          // 构建消息内容，本人消息\r\n          this.createContent(null, this.user.username, this.text)\r\n          this.text = '';\r\n        }\r\n      }\r\n    },\r\n    createContent(remoteUser, nowUser, text) {  // 这个方法是用来将 json的聊天消息数据转换成 html的。\r\n      let html\r\n      // 当前用户消息\r\n      if (nowUser) { // nowUser 表示是否显示当前用户发送的聊天消息，绿色气泡\r\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" +\r\n            \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: right; padding-right: 10px\\\">\\n\" +\r\n            \"    <div class=\\\"tip left\\\">\" + text + \"</div>\\n\" +\r\n            \"  </div>\\n\" +\r\n            \"  <div class=\\\"el-col el-col-2\\\">\\n\" +\r\n            \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" +\r\n            \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" +\r\n            \"  </span>\\n\" +\r\n            \"  </div>\\n\" +\r\n            \"</div>\";\r\n      } else if (remoteUser) {   // remoteUser表示远程用户聊天消息，蓝色的气泡\r\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" +\r\n            \"  <div class=\\\"el-col el-col-2\\\" style=\\\"text-align: right\\\">\\n\" +\r\n            \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" +\r\n            \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" +\r\n            \"  </span>\\n\" +\r\n            \"  </div>\\n\" +\r\n            \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: left; padding-left: 10px\\\">\\n\" +\r\n            \"    <div class=\\\"tip right\\\">\" + text + \"</div>\\n\" +\r\n            \"  </div>\\n\" +\r\n            \"</div>\";\r\n      }\r\n      console.log(html)\r\n      this.content += html;\r\n    },\r\n    init() {\r\n      this.user = localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\r\n      let username = this.user.username;\r\n      let _this = this;\r\n      if (typeof (WebSocket) == \"undefined\") {\r\n        console.log(\"您的浏览器不支持WebSocket\");\r\n      } else {\r\n        console.log(\"您的浏览器支持WebSocket\");\r\n        let socketUrl = \"ws://localhost:9090/imserver/\" + username;\r\n        // if (socket != null) {\r\n        //   socket.close();\r\n        //   socket = null;\r\n        // }\r\n        // 开启一个websocket服务\r\n        // socket = new WebSocket(socketUrl);\r\n        //打开事件\r\n        // socket.onopen = function () {\r\n        //   console.log(\"websocket已打开\");\r\n        // };\r\n        //  浏览器端收消息，获得从服务端发送过来的文本消息\r\n        // socket.onmessage = function (msg) {\r\n        //   console.log(\"收到数据====\" + msg.data)\r\n        //   let data = JSON.parse(msg.data)  // 对收到的json数据进行解析， 类似这样的： {\"users\": [{\"username\": \"zhang\"},{ \"username\": \"admin\"}]}\r\n        //   if (data.users) {  // 获取在线人员信息\r\n        //     _this.users = data.users.filter(user => user.username !== username)  // 获取当前连接的所有用户信息，并且排除自身，自己不会出现在自己的聊天列表里\r\n        //   } else {\r\n        //     // 如果服务器端发送过来的json数据 不包含 users 这个key，那么发送过来的就是聊天文本json数据\r\n        //     //  // {\"from\": \"zhang\", \"text\": \"hello\"}\r\n        //     if (data.from === _this.chatUser) {\r\n        //       _this.messages.push(data)\r\n        //       // 构建消息内容\r\n        //       _this.createContent(data.from, null, data.text)\r\n        //     }\r\n        //   }\r\n        // };\r\n        //关闭事件\r\n        // socket.onclose = function () {\r\n        //   console.log(\"websocket已关闭\");\r\n        // };\r\n        // //发生了错误事件\r\n        // socket.onerror = function () {\r\n        //   console.log(\"websocket发生了错误\");\r\n        // }\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n.tip {\r\n  color: white;\r\n  text-align: center;\r\n  border-radius: 10px;\r\n  font-family: sans-serif;\r\n  padding: 10px;\r\n  width:auto;\r\n  display:inline-block !important;\r\n  display:inline;\r\n}\r\n.right {\r\n  background-color: deepskyblue;\r\n}\r\n.left {\r\n  background-color: forestgreen;\r\n}\r\n.chat-card{\r\n  z-index: 99;\r\n}\r\n.chat-col{\r\n  z-index: 99;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}