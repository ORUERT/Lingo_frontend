{"ast":null,"code":"import _toConsumableArray from \"C:/Users/zhouy/WebstormProjects/lingo/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode } from \"vue\";\nimport { isRef, unref, computed, defineComponent, shallowRef, watch } from 'vue';\nimport { withConfirm, withError, withInfo, withSuccess, withWarn } from '../confirm';\nimport HookModal from './HookModal';\nimport destroyFns from '../destroyFns';\nvar uuid = 0;\nvar ElementsHolder = defineComponent({\n  name: 'ElementsHolder',\n  inheritAttrs: false,\n  setup: function setup(_, _ref) {\n    var expose = _ref.expose;\n    var modals = shallowRef([]);\n    var addModal = function addModal(modal) {\n      modals.value.push(modal);\n      modals.value = modals.value.slice();\n      return function () {\n        modals.value = modals.value.filter(function (currentModal) {\n          return currentModal !== modal;\n        });\n      };\n    };\n    expose({\n      addModal: addModal\n    });\n    return function () {\n      return modals.value.map(function (modal) {\n        return modal();\n      });\n    };\n  }\n});\nfunction useModal() {\n  var holderRef = shallowRef(null);\n  // ========================== Effect ==========================\n  var actionQueue = shallowRef([]);\n  watch(actionQueue, function () {\n    if (actionQueue.value.length) {\n      var cloneQueue = _toConsumableArray(actionQueue.value);\n      cloneQueue.forEach(function (action) {\n        action();\n      });\n      actionQueue.value = [];\n    }\n  }, {\n    immediate: true\n  });\n  // =========================== Hook ===========================\n  var getConfirmFunc = function getConfirmFunc(withFunc) {\n    return function hookConfirm(config) {\n      var _a;\n      uuid += 1;\n      var open = shallowRef(true);\n      var modalRef = shallowRef(null);\n      var configRef = shallowRef(unref(config));\n      var updateConfig = shallowRef({});\n      watch(function () {\n        return config;\n      }, function (val) {\n        updateAction(_extends(_extends({}, isRef(val) ? val.value : val), updateConfig.value));\n      });\n      var destroyAction = function destroyAction() {\n        open.value = false;\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n        var triggerCancel = args.some(function (param) {\n          return param && param.triggerCancel;\n        });\n        if (configRef.value.onCancel && triggerCancel) {\n          var _configRef$value;\n          (_configRef$value = configRef.value).onCancel.apply(_configRef$value, [function () {}].concat(_toConsumableArray(args.slice(1))));\n        }\n      };\n      // eslint-disable-next-line prefer-const\n      var closeFunc;\n      var modal = function modal() {\n        return _createVNode(HookModal, {\n          \"key\": \"modal-\".concat(uuid),\n          \"config\": withFunc(configRef.value),\n          \"ref\": modalRef,\n          \"open\": open.value,\n          \"destroyAction\": destroyAction,\n          \"afterClose\": function afterClose() {\n            closeFunc === null || closeFunc === void 0 ? void 0 : closeFunc();\n          }\n        }, null);\n      };\n      closeFunc = (_a = holderRef.value) === null || _a === void 0 ? void 0 : _a.addModal(modal);\n      if (closeFunc) {\n        destroyFns.push(closeFunc);\n      }\n      var updateAction = function updateAction(newConfig) {\n        configRef.value = _extends(_extends({}, configRef.value), newConfig);\n      };\n      var destroy = function destroy() {\n        if (modalRef.value) {\n          destroyAction();\n        } else {\n          actionQueue.value = [].concat(_toConsumableArray(actionQueue.value), [destroyAction]);\n        }\n      };\n      var update = function update(newConfig) {\n        updateConfig.value = newConfig;\n        if (modalRef.value) {\n          updateAction(newConfig);\n        } else {\n          actionQueue.value = [].concat(_toConsumableArray(actionQueue.value), [function () {\n            return updateAction(newConfig);\n          }]);\n        }\n      };\n      return {\n        destroy: destroy,\n        update: update\n      };\n    };\n  };\n  var fns = computed(function () {\n    return {\n      info: getConfirmFunc(withInfo),\n      success: getConfirmFunc(withSuccess),\n      error: getConfirmFunc(withError),\n      warning: getConfirmFunc(withWarn),\n      confirm: getConfirmFunc(withConfirm)\n    };\n  });\n  var holderKey = Symbol('modalHolderKey');\n  return [fns.value, function () {\n    return _createVNode(ElementsHolder, {\n      \"key\": holderKey,\n      \"ref\": holderRef\n    }, null);\n  }];\n}\nexport default useModal;","map":{"version":3,"names":["_extends","createVNode","_createVNode","isRef","unref","computed","defineComponent","shallowRef","watch","withConfirm","withError","withInfo","withSuccess","withWarn","HookModal","destroyFns","uuid","ElementsHolder","name","inheritAttrs","setup","_","_ref","expose","modals","addModal","modal","value","push","slice","filter","currentModal","map","useModal","holderRef","actionQueue","length","cloneQueue","_toConsumableArray","forEach","action","immediate","getConfirmFunc","withFunc","hookConfirm","config","_a","open","modalRef","configRef","updateConfig","val","updateAction","destroyAction","_len","arguments","args","Array","_key","triggerCancel","some","param","onCancel","_configRef$value","apply","concat","closeFunc","afterClose","newConfig","destroy","update","fns","info","success","error","warning","confirm","holderKey","Symbol"],"sources":["C:/Users/zhouy/WebstormProjects/lingo/node_modules/ant-design-vue/es/modal/useModal/index.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode } from \"vue\";\nimport { isRef, unref, computed, defineComponent, shallowRef, watch } from 'vue';\nimport { withConfirm, withError, withInfo, withSuccess, withWarn } from '../confirm';\nimport HookModal from './HookModal';\nimport destroyFns from '../destroyFns';\nlet uuid = 0;\nconst ElementsHolder = defineComponent({\n  name: 'ElementsHolder',\n  inheritAttrs: false,\n  setup(_, _ref) {\n    let {\n      expose\n    } = _ref;\n    const modals = shallowRef([]);\n    const addModal = modal => {\n      modals.value.push(modal);\n      modals.value = modals.value.slice();\n      return () => {\n        modals.value = modals.value.filter(currentModal => currentModal !== modal);\n      };\n    };\n    expose({\n      addModal\n    });\n    return () => {\n      return modals.value.map(modal => modal());\n    };\n  }\n});\nfunction useModal() {\n  const holderRef = shallowRef(null);\n  // ========================== Effect ==========================\n  const actionQueue = shallowRef([]);\n  watch(actionQueue, () => {\n    if (actionQueue.value.length) {\n      const cloneQueue = [...actionQueue.value];\n      cloneQueue.forEach(action => {\n        action();\n      });\n      actionQueue.value = [];\n    }\n  }, {\n    immediate: true\n  });\n  // =========================== Hook ===========================\n  const getConfirmFunc = withFunc => function hookConfirm(config) {\n    var _a;\n    uuid += 1;\n    const open = shallowRef(true);\n    const modalRef = shallowRef(null);\n    const configRef = shallowRef(unref(config));\n    const updateConfig = shallowRef({});\n    watch(() => config, val => {\n      updateAction(_extends(_extends({}, isRef(val) ? val.value : val), updateConfig.value));\n    });\n    const destroyAction = function () {\n      open.value = false;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      const triggerCancel = args.some(param => param && param.triggerCancel);\n      if (configRef.value.onCancel && triggerCancel) {\n        configRef.value.onCancel(() => {}, ...args.slice(1));\n      }\n    };\n    // eslint-disable-next-line prefer-const\n    let closeFunc;\n    const modal = () => _createVNode(HookModal, {\n      \"key\": `modal-${uuid}`,\n      \"config\": withFunc(configRef.value),\n      \"ref\": modalRef,\n      \"open\": open.value,\n      \"destroyAction\": destroyAction,\n      \"afterClose\": () => {\n        closeFunc === null || closeFunc === void 0 ? void 0 : closeFunc();\n      }\n    }, null);\n    closeFunc = (_a = holderRef.value) === null || _a === void 0 ? void 0 : _a.addModal(modal);\n    if (closeFunc) {\n      destroyFns.push(closeFunc);\n    }\n    const updateAction = newConfig => {\n      configRef.value = _extends(_extends({}, configRef.value), newConfig);\n    };\n    const destroy = () => {\n      if (modalRef.value) {\n        destroyAction();\n      } else {\n        actionQueue.value = [...actionQueue.value, destroyAction];\n      }\n    };\n    const update = newConfig => {\n      updateConfig.value = newConfig;\n      if (modalRef.value) {\n        updateAction(newConfig);\n      } else {\n        actionQueue.value = [...actionQueue.value, () => updateAction(newConfig)];\n      }\n    };\n    return {\n      destroy,\n      update\n    };\n  };\n  const fns = computed(() => ({\n    info: getConfirmFunc(withInfo),\n    success: getConfirmFunc(withSuccess),\n    error: getConfirmFunc(withError),\n    warning: getConfirmFunc(withWarn),\n    confirm: getConfirmFunc(withConfirm)\n  }));\n  const holderKey = Symbol('modalHolderKey');\n  return [fns.value, () => _createVNode(ElementsHolder, {\n    \"key\": holderKey,\n    \"ref\": holderRef\n  }, null)];\n}\nexport default useModal;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}